<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Адаптивное меню с эффектами</title>
  <script src="https://cdn.tailwindcss.com "></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css ">
  <style>
    /* Анимация блика при наведении */
    .menu-btn, .category-item {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .menu-btn::after, .category-item::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);
      transform: rotate(30deg) translate(-20px, 40px);
      transition: all 0.5s ease;
      opacity: 0;
    }
    .menu-btn:hover::after, .category-item:hover::after {
      opacity: 1;
      transform: rotate(30deg) translate(20px, -40px);
    }

    /* Цвета иконок при наведении */
    .menu-icon {
      transition: all 0.3s ease;
      color: #9ca3af;
    }
    .news-btn:hover .menu-icon {
      color: #3b82f6 !important;
      transform: scale(1.5);
    }
    .video-btn:hover .menu-icon {
      color: #ef4444 !important;
      transform: scale(1.5);
    }
    .categories-btn:hover .menu-icon {
      color: #10b981 !important;
      transform: scale(1.5);
    }

    /* Выпадающее меню */
    .dropdown-menu {
      display: none;
      animation: fadeIn 0.3s ease forwards;
    }
    .dropdown-menu.open {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .dropdown:hover .dropdown-menu {
      display: block;
    }

    /* Стили для пунктов выпадающего меню */
    .category-item {
      transition: all 0.3s ease;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .category-item:hover {
      background-color: rgba(0, 0, 0, 0.7) !important;
      transform: scale(1.02);
    }
    .category-item:hover .category-text {
      font-size: 1.05rem;
    }
    .category-item.active {
      background-color: rgba(0, 0, 0, 0.9) !important;
    }
    .category-item.active::after {
      opacity: 1;
    }

    /* Иконки категорий */
    .category-icon {
      width: 20px;
      text-align: center;
      margin-right: 8px;
      color: #9ca3af;
      transition: all 0.3s ease;
    }
    .category-item:hover .category-icon {
      transform: scale(1.5);
    }

    /* Цвета иконок категорий */
    .anime .category-icon { color: #8b5cf6 !important; }
    .games .category-icon { color: #ffd791 !important; }
    .fashion .category-icon { color: #ec4899 !important; }
    .music .category-icon { color: #3b82f6 !important; }
    .movies .category-icon { color: #ef4444 !important; }
    .netanya .category-icon { color: #5eff00 !important; }
    .relationships .category-icon { color: #fcff63 !important; }
    .theater .category-icon { color: #fdba00 !important; }
    .school .category-icon { color: #14b8a6 !important; }

    /* Фиксированное меню */
    .header-menu {
      backdrop-filter: blur(10px);
    }

    /* Для мобильных - скрываем текст в кнопках */
    @media (max-width: 639px) {
      .menu-text {
        display: none;
      }
      .dropdown-arrow {
        display: none;
      }
    }

    /* Для десктопов - показываем текст в кнопках */
    @media (min-width: 640px) {
      .menu-text {
        display: inline;
      }
      .dropdown-arrow {
        display: inline;
      }
    }

    /* Блок результатов поиска и фильтрации */
    .search-container {
      position: relative;
      width: 100%;
      max-width: 200px;
    }
    .search-results-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 50;
      width: 100%;
      max-height: 300px;
      overflow-y: auto;
      background-color: #1f2937;
      border-radius: 0.5rem;
      padding: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: none;
    }
    .search-result-item,
    .category-result-item {
      padding: 8px 10px;
      margin-bottom: 5px;
      border-radius: 0.375rem;
      background-color: rgba(255,255,255,0.05);
      transition: background-color 0.3s ease;
    }
    .search-result-item:hover,
    .category-result-item:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .result-title {
      font-weight: bold;
      color: white;
    }

    .result-meta {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    #categoryResults {
      margin-top: 20px;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 0.5rem;
    }

    #categoryResults h2 {
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      margin-bottom: 10px;
    }

    .category-result-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .category-result-item a {
      font-weight: bold;
      color: white;
    }

    .category-result-item small {
      color: #9ca3af;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

<!-- Полупрозрачное меню -->
<header class="header-menu bg-black bg-opacity-70 fixed w-full z-50">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between h-16">
      <!-- Основное меню -->
      <div class="flex items-center space-x-1 sm:space-x-2">
        <!-- Новости -->
        <a href="index.html" class="menu-btn news-btn bg-black bg-opacity-60 text-white px-3 py-2 rounded-full flex items-center">
          <i class="menu-icon fas fa-newspaper text-gray-400 sm:mr-2"></i>
          <span class="menu-text">Новости</span>
        </a>
        <!-- Видео -->
        <a href="video.html" class="menu-btn video-btn bg-black bg-opacity-60 text-white px-3 py-2 rounded-full flex items-center">
          <i class="menu-icon fas fa-video text-gray-400 sm:mr-2"></i>
          <span class="menu-text">Видео</span>
        </a>
        <!-- Рубрики с выпадающим меню -->
        <div class="dropdown relative">
          <button class="menu-btn categories-btn bg-black bg-opacity-60 text-white px-3 py-2 rounded-full flex items-center">
            <i class="menu-icon fas fa-tags text-gray-400 sm:mr-2"></i>
            <span class="menu-text">Рубрики</span>
            <i class="dropdown-arrow fas fa-chevron-down ml-1 text-xs text-gray-400"></i>
          </button>
          <!-- Выпадающее меню рубрик -->
          <div class="dropdown-menu absolute left-0 mt-2 w-48 bg-black bg-opacity-80 rounded-md shadow-lg py-1 z-50 backdrop-blur-sm">
            <a href="#category=anime" class="category-item anime block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-dragon"></i></span>
              <span class="category-text">Аниме</span>
            </a>
            <a href="#category=games" class="category-item games block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-gamepad"></i></span>
              <span class="category-text">Игры</span>
            </a>
            <a href="#category=fashion" class="category-item fashion block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-tshirt"></i></span>
              <span class="category-text">Мода</span>
            </a>
            <a href="#category=music" class="category-item music block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-music"></i></span>
              <span class="category-text">Музыка</span>
            </a>
            <a href="#category=movies" class="category-item movies block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-film"></i></span>
              <span class="category-text">Кино</span>
            </a>
            <a href="#category=netanya" class="category-item netanya block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-umbrella-beach"></i></span>
              <span class="category-text">Нетания</span>
            </a>
            <a href="#category=relationships" class="category-item relationships block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-smile"></i></span>
              <span class="category-text">Отношения</span>
            </a>
            <a href="#category=theater" class="category-item theater block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-theater-masks"></i></span>
              <span class="category-text">Театр</span>
            </a>
            <a href="#category=school" class="category-item school block px-4 py-2 text-white hover:bg-opacity-70">
              <span class="category-icon"><i class="fas fa-graduation-cap"></i></span>
              <span class="category-text">Школа</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Поиск -->
      <div class="relative ml-2 search-container">
        <input type="text" id="searchInput" placeholder="Поиск..." 
               class="bg-gray-700 bg-opacity-50 text-white px-4 py-1 rounded-full text-sm 
                      focus:outline-none focus:ring-1 focus:ring-white focus:bg-opacity-70
                      w-24 sm:w-40 transition-all duration-300 placeholder-gray-300">
        <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-300 hover:text-white">
          <i class="fas fa-search"></i>
        </button>
        <!-- Результаты поиска -->
        <div id="searchResults" class="search-results-dropdown"></div>
      </div>
    </nav>
  </div>
</header>

<!-- Контент страницы + результаты по категории -->
<main class="pt-20 pb-10 px-4 container mx-auto">
  <h1 class="text-3xl font-bold mb-6">Адаптивное меню с эффектами</h1>
  <p class="mb-4">Попробуйте изменить размер окна или ориентацию устройства.</p>
  <p class="mb-4">Наведите на пункты меню, чтобы увидеть анимацию и изменение цвета иконок.</p>
  <p>Нажмите на "Рубрики", чтобы выбрать категорию и увидеть результаты ниже.</p>

  <!-- Блок с результатами по выбранной категории -->
  <section id="categoryResults" class="hidden">
    <h2 id="categoryTitle" class="text-xl font-semibold mb-4">Результаты по категории:</h2>
    <div class="category-result-list" id="categoryResultList"></div>
  </section>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const dropdown = document.querySelector('.dropdown');
    const dropdownButton = document.querySelector('.dropdown button');
    const dropdownMenu = document.querySelector('.dropdown-menu');
    const categoryItems = document.querySelectorAll('.category-item');

    // Открытие/закрытие меню по клику
    dropdownButton.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      if (dropdownMenu.classList.contains('open')) {
        dropdownMenu.classList.remove('open');
      } else {
        dropdownMenu.classList.add('open');
      }
    });

    // Обработка выбора категории
    categoryItems.forEach(item => {
      item.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        const selectedCategory = this.getAttribute('href').replace('#category=', '');
        categoryItems.forEach(i => i.classList.remove('active'));
        this.classList.add('active');

        // Запускаем фильтрацию по категории
        filterPagesByCategory(selectedCategory);

        if (window.innerWidth < 640) {
          dropdownMenu.classList.remove('open');
        }
      });
    });

    // Закрытие меню вне клика
    document.addEventListener('click', function (e) {
      if (!e.target.closest('.dropdown')) {
        dropdownMenu.classList.remove('open');
      }
    });

    // Адаптация на ресайз
    window.addEventListener('resize', function () {
      if (window.innerWidth >= 640 && dropdownMenu.classList.contains('open')) {
        dropdownMenu.classList.remove('open');
      }
    });
  });

  // === ПОИСК ПО СТРАНИЦЕ ===
  const pages = [
    "index.html",
    "video.html",
    "news.html",
    "anime.html",
    "games.html",
    "fashion.html",
    "music.html",
    "movies.html",
    "netanya.html",
    "relationships.html",
    "theater.html",
    "school.html"
  ];

  const searchInput = document.getElementById('searchInput');
  const resultsBox = document.getElementById('searchResults');
  const categoryResultsSection = document.getElementById('categoryResults');
  const categoryResultList = document.getElementById('categoryResultList');
  const categoryTitle = document.getElementById('categoryTitle');

  async function loadPageMetadata(pageUrl) {
    try {
      const response = await fetch(pageUrl);
      const text = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');

      const metadata = doc.querySelector('.page-metadata');
      const title = doc.title || pageUrl;

      if (metadata) {
        return {
          url: pageUrl,
          title: title,
          category: metadata.getAttribute('data-category') || '',
          author: metadata.getAttribute('data-author') || '',
          date: metadata.getAttribute('data-date') || ''
        };
      } else {
        return {
          url: pageUrl,
          title: title,
          category: '',
          author: '',
          date: ''
        };
      }
    } catch (err) {
      console.error(`Ошибка загрузки ${pageUrl}:`, err);
      return null;
    }
  }

  async function performSearch(query) {
    if (!query.trim()) {
      resultsBox.innerHTML = '';
      resultsBox.classList.add('hidden');
      return;
    }

    let foundResults = [];

    for (const page of pages) {
      try {
        const response = await fetch(page);
        const text = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');

        const metadata = doc.querySelector('.page-metadata');
        const title = doc.title || page;

        let contentText = '';

        if (metadata) {
          contentText = metadata.textContent + ' ' + doc.body.textContent;
        } else {
          contentText = doc.body.textContent;
        }

        const queryLC = query.toLowerCase();
        const contentLC = contentText.toLowerCase();

        if (contentLC.includes(queryLC)) {
          foundResults.push({
            url: page,
            title: title
          });
        }
      } catch (err) {
        console.error(`Ошибка загрузки ${page}:`, err);
      }
    }

    showSearchResults(foundResults);
  }

  function showSearchResults(results) {
    resultsBox.innerHTML = "";
    if (results.length === 0) {
      resultsBox.innerHTML = '<div class="text-gray-400 text-sm p-2">Ничего не найдено</div>';
      resultsBox.classList.remove('hidden');
      return;
    }

    results.forEach(result => {
      const item = document.createElement("div");
      item.className = "search-result-item";
      item.innerHTML = `<a href="${result.url}" target="_blank">${result.title}</a>`;
      resultsBox.appendChild(item);
    });

    resultsBox.classList.remove('hidden');
  }

  searchInput.addEventListener('input', () => {
    const query = searchInput.value;
    performSearch(query);
  });

  document.addEventListener('click', e => {
    if (!e.target.closest('.search-container')) {
      resultsBox.classList.add('hidden');
    }
  });

  // === ФИЛЬТРАЦИЯ ПО КАТЕГОРИИ ===
  async function filterPagesByCategory(category) {
    if (!category) return;

    const filtered = [];
    for (const page of pages) {
      const data = await loadPageMetadata(page);
      if (data && data.category === category) {
        filtered.push(data);
      }
    }

    showCategoryResults(filtered, category);
  }

  function showCategoryResults(results, categoryName) {
    categoryResultList.innerHTML = "";

    if (results.length === 0) {
      categoryResultList.innerHTML = "<p>Ничего не найдено.</p>";
      categoryResultsSection.classList.remove('hidden');
      categoryTitle.innerText = `Ничего не найдено`;
      return;
    }

    results.forEach(item => {
      const div = document.createElement("div");
      div.className = "category-result-item";
      div.innerHTML = `
        <a href="${item.url}">${item.title}</a>
        <small>Категория: ${item.category}, Автор: ${item.author || 'Не указан'}, Дата: ${item.date || 'Не указана'}</small>
      `;
      categoryResultList.appendChild(div);
    });

    categoryTitle.innerText = `Результаты по категории: ${categoryName}`;
    categoryResultsSection.classList.remove('hidden');
  }

  function getHashCategory() {
    const hash = window.location.hash.replace('#category=', '').toLowerCase();
    const validCategories = ['anime', 'games', 'fashion', 'music', 'movies', 'netanya', 'relationships', 'theater', 'school'];
    return validCategories.includes(hash) ? hash : null;
  }

  window.addEventListener('hashchange', () => {
    const category = getHashCategory();
    if (category) {
      filterPagesByCategory(category);
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    const category = getHashCategory();
    if (category) {
      filterPagesByCategory(category);
    }
  });
</script>

</body>
</html>
